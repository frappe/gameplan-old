{% extends "templates/base.html" %}

{% block title %}{{ title }}{% endblock %}

{% block content %}
<a href="/">
    <p class='text-muted'>
        Back to discussions
    </p>
</a>

<h4>{{ title }}</h4>
<div class="gameplan-comment-body">
{{ content }}
</div>

<div class="comments">
{% for comment in comments %}
{% include "gameplan/templates/includes/comment.html" %}
{% endfor %}
</div>

{% include "gameplan/templates/includes/new_content.html" %}

<script>
window.discussion_name = "{{ name }}";
frappe.ready(function() {
    $('.new-discussion-content')
        .on("keydown", function(e) {
            if(e.which==13 && (e.ctrlKey || e.metaKey)) {
                frappe.call({
                    method: "gameplan.api.add_comment",
                    args: {
                        name: window.discussion_name,
                        content: $('.new-discussion-content').val()
                    },
                    success: function(r) {
                        $(r.message).appendTo('.comments');
                        $('.new-discussion-content').val('');
                    }
                });
            }
        });
});
</script>

{% endblock %}

